# Booting - Initializing - Virtualizing Linux

---

# Mục lục

* [1. ](#1)

*

---

<a name = '1'></a>
## 1. Khái niệm Boot Process
- Hệ điều hành là phần trung gian giữa ứng dụng tương tác với phần cứng. 
- `Firmware` là một chương trình đã được lập trình, trình điều khiển gắn liền với thiết bị. Có chức năng điều khiển tính năng cơ bản nhất, chủ yếu là truy xuất dữ liệu, cách thức tương tác truyền nhận thông tin với thiết bị khác. Được lưu trong bộ lưu trữ trong ROM (read only ..). Ít khi phải cập nhật hay sửa đổi, là tập lệnh cơ bản. 
- `Driver` là chương trình được cài đặt trên hệ điều hành. Thiết bị vật lí đa dạng, mà hệ điều hành cần hỗ trợ tất cả các thiết bị. Nên để thống nhất được ngôn ngữ chung thì họ sáng tạo ra driver, trình điều khiển thiết bị, gắn ở phía đầu hệ điều hành. Hđh tương tác với firmware qua driver. Tối giản hóa kernel, tăng tóc độ boot.
- `Sofmware` là phần mềm phục vụ nhu cầu con người. Thường thực hiện nhiều chức năng, cần nhiều thiết bị phục vụ để đáp ứng được nhu cầu con người. Hđh là một phần mềm **đặc biệt**. Và muốn phần mềm được phát huy tối đa thì phần cứng cũng phải khỏe. Firmware là bộ não, quyết định mọi lệnh.
- `Firmware` bao gồm **BIOS** hoặc **UEFI** để thực hiện check lỗi trước khi booting vào hđh. 
- **Boot Loader** là thành phần quan trọng khởi chạy sau khi hoàn thành kiểm tra thiết bị. Cho phép người dùng chọn hệ điều hành, tương tác và thay đổi tham số để điều chỉnh quá trình khởi động hoặc troubleshoop để sửa lỗi, k cho boot theo cách bình thường. 
- Sau đó khởi chạy kernel hệ điều hành, mount 1 file system ảo lên RAM, chứa các driver để kernel tương tác được với phần cứng. 
- Có một số loại ví dụ: LILO (phiên bản cũ, chỉ hỗ trợ BIOS, và bỏ dần trên các phiên bản Linux thế hệ mới), GRUB Legacy (được ra đời năm 1999, có nhiều tính năng hay: cho phép tùy biến, hỗ trợ 2 loại BIOS và UEFI, có hạn chế đối với thiết bị vật lý: k tích hợp được nhiều driver) và đó là lí do ra đời GRUB v2(hỗ trợ nhiều tính năng: cho phép load drvier một cách thuận tiện, thích hợp nhiều thiết bị vật lí)

<a name = '2'></a>
## 2. Cài đặt boot loader: GRUB Legacy và GRUB v2
- Config file menu.lst 
  - Thiết lập chung GRUB Legacy: Thiết lập màn hình, hiển thị, chữ màu nền, giao diện, hình nền, thời gian
  - Thiết lập OSB (Operating system boot): dành riêng cho từng hệ điều hành cài trên máy chủ. 
| Cài đặt | Mô tả |
| ------- | ----- |
| color | 
| defaul | 

- GRUB v2: Đây là phiên bản nâng cấp của GRUB Legacy với nhiều cải tiến: tập trung khả năng hỗ trợ các thiết bị, load driver để tương thích nhiều thiết bị. Giao diện và cách sử dụng tương tự GRUB Legacy nên khá thân thiện và đã được hiển thị trên màn hình. 
  - File cấu hình đã thay đổi thành grub.cfg
  - Lệnh cài GRUB v2: 
     - Đối với BIOS: `# grub2-install /dev/sda `
     - Đối với UEFI:  `# yum reinstall grub2-efi grub2-efi-modules shim`
- Config: Chỉnh sửa nội dung grub.cfg. Khá phức tạp vì thêm nhiều tính năng nên nội dung file cũng thêm nhiều. Khuyến cáo k nên config bằng tay


<a name = '3'></a>
## 3. Initialization Proces
- Có 2 init Program phổ biến: `SysVinit` - `systemd` 
- `SysVinit` Kế thừa cách thức hoạt động từ Unix System V. Định nghĩa trạng thái của hệ thống (run levels) sử dụng đánh số từ 0-6. Ra đời đầu tiên nên có hạn chế: chỉ phù hợp với phần cứng cố định, k hỗ trợ nhận diện thiết bị mới (USB cắm vào k tự động nhận diện). Hiệu năng khởi động k cao, khởi động từng dịch vụ
- `systemd` Ra đời 2010, được sử dụng phổ biến trên các phiên bản hệ điều hành Linux. Có thể quản lý nhiều tệp, nhiều mảng, hỗ trợ nhiều tính năng cho người quản trị. 
![1]/image/Runlevel.png
- `SysVinit`
  - Dùng nhiều: mức 0(Shutdown sys) và 6(Reboot sys). 1,s,S là single-user mode = safe mode của window, chỉ hỗ trợ 1 người dùng và chạy những dịch vụ cơ bản nhất (dùng khi có các tiến trình lạ khởi động) 
  - 2 là multi-user hoạt động ở chế độ k có networking. 3 là multi-user hoạt động ở chế độ có networking nhưng chưa có giao diện. 4 là custom, người dùng tự định nghĩa (ít khi sử dụng). 5 là có thêm giao diện đồ họa. 
  -  Câu lệnh Service + `SCRIPT` + `COMMAND` (script là tên dịch vụ nằm trong thư mục etcinit.d)
| Command | Mô tả |
| ------- | ----- |
| restart | Khởi động |
| start | Chạy |
| status | Xem trạng thái |
| stop | Dừng dịch vụ |
| reload | Cấu hình refresh, dữ liệu được làm mới |

- `systemd` 
   - Mọi đối tượng được gọi chung là Unit. Service type: các dịch vụ chạy trên hệ điều hành được định nghĩa theo dạng này. Target là unit type đặc biệt, trong đó mỗi targer được tập hợp từ nhiều service.
   - Cấu hình **service** 
     - Exec: Truyền vào giá trị đường dẫn, scrip. Khi cần tương tác thì các scrip đấy được gọi ra.
     - Envi: Biến môi trường cần thiết
     - Restart: Khai báo service cần phải làm khi process bị dừng lại hoặc gặp trạng thái bất thường. 
   - Install: 
     - Alias: Bí danh để gọi tắt
     - Also: Cho phép thiết lập enable hoặc disable theo nhóm.
   - Target Unit: Đơn giản hóa quá trình khởi động. Gom service để khởi động hệ thống vào các trạng thái hoạt động khác nhau. 
   - 
