# Securing your system

---

# Mục lục

* [1. Quản lí an ninh mạng](#1)

* [2. Vòng lặp](#2)



---

<a name = '1'></a>
## 1. Quản lí an ninh mạng 

### 1.1 Disabling Unused Services
- Một trong những phương pháp để bảo vệ hệ thống là gỡ các phần mềm không cần thiết hoặc không còn sử dụng. Vì trong mỗi phần mềm đều có nguy cơ bị xâm nhập nên việc gỡ bỏ những phần mềm không cần thiết là cần thiết, giảm thiểu tối đa trở thành mục tiêu của hacker.
- Discovering Open Ports with `nmap`
    - The Network Mapper (nmap) thường được sử dụng để kiểm tra các truy nhập vào hệ thống.
    - Để cài đặt `nmap` ta dùng lệnh: 
    `yum install nmap`
    - Chúng ta có thể thực hiện quét một địa chỉ IPv4 để tìm hiểu các cổng, dịch vụ và địa chỉ MAC mở trên hệ thống: 
    ```
    [root@centsvr ~]# nmap -sT 127.0.0.1
    Starting Nmap 7.70 ( https://nmap.org ) at 2021-03-23 14:08 +07
    Nmap scan report for localhost (127.0.0.1)
    Host is up (0.00052s latency).
    Not shown: 997 closed ports
    PORT    STATE SERVICE
    22/tcp  open  ssh
    111/tcp open  rpcbind
    631/tcp open  ipp

    Nmap done: 1 IP address (1 host up) scanned in 0.12 seconds
    ```
- Identifying Open Ports with `netstat`
    - Đây là công cụ hữu dụng trong dịch vụ mạng. Nó hiển thị rất đầy đủ, nhưng chính vì cái này nên có thể gây phức tạp với những người mới sử dụng. 
    ```
    [root@centsvr ~]# netstat --tcp --listening
    Active Internet connections (only servers)
    Proto Recv-Q Send-Q Local Address           Foreign Address         State
    tcp        0      0 0.0.0.0:sunrpc          0.0.0.0:*               LISTEN
    tcp        0      0 centsvr:domain          0.0.0.0:*               LISTEN
    tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN
    tcp        0      0 localhost:ipp           0.0.0.0:*               LISTEN
    tcp        0      0 localhos:x11-ssh-offset 0.0.0.0:*               LISTEN
    tcp6       0      0 [::]:sunrpc             [::]:*                  LISTEN
    tcp6       0      0 [::]:ssh                [::]:*                  LISTEN
    tcp6       0      0 localhost:ipp           [::]:*                  LISTEN
    tcp6       0      0 localhos:x11-ssh-offset [::]    :*                  LISTEN
    ```
- Surveying Network Sockét via ss and systemd.socket
    - `ss` có thể thay thế công cụ `netstat`, có thể xem socket của cả IPv4 và IPv6
    ![1](/image/2021-03-23_14-57-10.png)
    - Quản lí tiến trình bằng lệnh `systemctl` 
    ```[root@centsvr ~]# systemctl list-sockets --all --no-pager --full
    LISTEN                            UNIT                            ACTIVATES
    /run/avahi-daemon/socket          avahi-daemon.socket             avahi-daemon.service
    /run/dbus/system_bus_socket       dbus.socket                     dbus.service
    /run/dmeventd-client              dm-event.socket                 dm-event.service
    /run/dmeventd-server              dm-event.socket                 dm-event.service
    /run/initctl                      systemd-initctl.socket          systemd-initctl.service
    /run/libvirt/libvirt-admin-sock   libvirtd-admin.socket           libvirtd.service
    /run/libvirt/libvirt-sock         libvirtd.socket                 libvirtd.service
    /run/libvirt/libvirt-sock-ro      libvirtd-ro.socket              libvirtd.service
    /run/libvirt/virtlockd-admin-sock virtlockd-admin.socket          virtlockd.service
    /run/libvirt/virtlockd-sock       virtlockd.socket                virtlockd.service
    /run/libvirt/virtlogd-admin-sock  virtlogd-admin.socket           virtlogd.service
    /run/libvirt/virtlogd-sock        virtlogd.socket                 virtlogd.service
    /run/lvm/lvmpolld.socket          lvm2-lvmpolld.socket            lvm2-lvmpolld.service
    /run/rpcbind.sock                 rpcbind.socket                  rpcbind.service
    /run/systemd/coredump             systemd-coredump.socket         systemd-coredump@0.service
    /run/systemd/journal/dev-log      systemd-journald-dev-log.socket systemd-journald.service
    /run/systemd/journal/socket       systemd-journald.socket         systemd-journald.service
    /run/systemd/journal/stdout       systemd-journald.socket         systemd-journald.service
    /run/systemd/journal/syslog       syslog.socket                   rsyslog.service
    /run/udev/control                 systemd-udevd-control.socket    systemd-udevd.service
    /var/run/.heim_org.h5l.kcm-socket sssd-kcm.socket                 sssd-kcm.service
    /var/run/cups/cups.sock           cups.socket                     cups.service
    0.0.0.0:111                       rpcbind.socket                  rpcbind.service
    0.0.0.0:111                       rpcbind.socket                  rpcbind.service
    @ISCSIADM_ABSTRACT_NAMESPACE      iscsid.socket                   iscsid.service
    @ISCSID_UIP_ABSTRACT_NAMESPACE    iscsiuio.socket                 iscsiuio.service
    [::]:111                          rpcbind.socket                  rpcbind.service
    [::]:111                          rpcbind.socket                  rpcbind.service
    audit 1                           systemd-journald-audit.socket   systemd-journald.service
    kobject-uevent 1                  systemd-udevd-kernel.socket     systemd-udevd.service
    30 sockets listed.
- Auditing Open Files with Isof and fuser
    - `lsof` (list open files) được sử dụng để hiện thị danh sách các tệp đang mở. 
    ```
    [root@centsvr ~]# lsof
    COMMAND    PID  TID TASKCMD             USER   FD      TYPE             DEVICE  SIZE/OFF       NODE NAME
    systemd      1                          root  cwd       DIR              253,0       224        128 /
    systemd      1                          root  rtd       DIR              253,0       224        128 /
    systemd      1                          root  txt       REG              253,0   1609256   33968316 /usr/lib/systemd/systemd
    systemd      1                          root  mem       REG              253,0   2191808   50333091 /usr/lib64/libm-2.28.so
    systemd      1                          root  mem       REG              253,0    628728   50825890 /usr/lib64/libudev.so.1.6.11
    systemd      1                          root  mem       REG              253,0    969832   50343751 /usr/lib64/libsepol.so.1
    systemd      1                          root  mem       REG              253,0   1805368   50344051 /usr/lib64/libunistring.so.2.1.0
    systemd      1                          root  mem       REG              253,0    355456   50344293 /usr/lib64/libpcap.so.1.9.0
    systemd      1                          root  mem       REG              253,0    145984   50343844 /usr/lib64/libgpg-error.so.0.24.2
    systemd      1                          root  mem       REG              253,0     71528   50344142 /usr/lib64/libjson-c.so.4.0.0
    systemd      1                          root  mem       REG              253,0    371696   50734202 /usr/lib64/libdevmapper.so.1.02
    systemd      1                          root  mem       REG              253,0     26704   50343977 /usr/lib64/libattr.so.1.1.2448
    systemd      1                          root  mem       REG              253,0   3071424   50826586 /usr/lib64/libcrypto.so.1.1.1g
    systemd      1                          root  mem       REG              253,0    615560   50826588 /usr/lib64/libssl.so.1.1.1g
    systemd      1                          root  mem       REG              253,0     95232   50343754 /usr/lib64/libz.so.1.2.11
    systemd      1                          root  mem       REG              253,0     24736   50344010 /usr/lib64/libcap-ng.so.0.0.0
    systemd      1                          root  mem       REG              253,0     33232   50343818 /usr/lib64/libuuid.so.1.3.0
    systemd      1                          root  mem       REG              253,0     28968   50333089 /usr/lib64/libdl-2.28.so
    systemd      1                          root  mem       REG              253,0    553480   50333034 /usr/lib64/libpcre2-8.so.0.7.1
    systemd      1                          root  mem       REG              253,0    343464   50825895 /usr/lib64/libblkid.so.1.1.0
    systemd      1                          root  mem       REG              253,0     96056   50344170 /usr/lib64/liblz4.so.1.8.1
    systemd      1                          root  mem       REG              253,0    192024   50343783 /usr/lib64/liblzma.so.5.2.4
    systemd      1                          root  mem       REG              253,0    165624   50344056 /usr/lib64/libidn2.so.0.3.6
    systemd      1                          root  mem       REG              253,0     33272   50344298 /usr/lib64/libip4tc.so.2.0.0    
    systemd      1                          root  mem       REG              253,0   1465680   50344049 /usr/lib64/libgcrypt.so.20.2.3
    systemd      1                          root  mem       REG              253,0    510184   50826102 /usr/lib64/libcryptsetup.so.12.6.0
    systemd      1                          root  mem       REG              253,0     59272   50343980 /usr/lib64/libacl.so.1.1.2253
    systemd      1                          root  mem       REG              253,0     24800   50343809 /usr/lib64/libcap.so.2.26
    systemd      1                          root  mem       REG              253,0   3154704   50333087 /usr/lib64/libc-2.28.so
    systemd      1                          root  mem       REG              253,0    320504   50333101 /usr/lib64/libpthread-2.28.so
    systemd      1                          root  mem       REG              253,0     99680   50331784 /usr/lib64/libgcc_s-8-20191121.so.1
    systemd      1                          root  mem       REG              253,0    100208   50826045 /usr/lib64/libkmod.so.2.3.3
    systemd      1                          root  mem       REG              253,0    123336   50344012 /usr/lib64/libaudit.so.1.0.0
    systemd      1                          root  mem       REG              253,0     66272   50825995 /usr/lib64/libpam.so.0.84.2
    ...
    ```
    - `fuser` cung cấp thông tin về chương trình và tiến trình của người dùng. 
- Disabling the Services
    - Sử dụng lệnh `systemctl` để vô hiệu hóa một dịch vụ 
    ```
    systemctl disable SERVICE-NAME 
    ```
### 1.2 Using Super Server Restrictions
- Cấu hình `xinetd`: yum install -y xinetd
    - Xinetd là một dịch vụ dùng để thay thế cho những internet service daemon cũ như inetd, tcp_wrappers...
    - Chức năng: Đóng vai trò là một máy chủ. 
    - File cấu hình lưu tại thư mục: `/etc/xinetd.conf/`
    ```
    [root@client3 ~]# cat /etc/xinetd.conf
    #
    # This is the master xinetd configuration file. Settings in the
    # default section will be inherited by all service configurations
    # unless explicitly overridden in the service configuration. See
    # xinetd.conf in the man pages for a more detailed explanation of
    # these attributes.
    defaults
    {
    # The next two items are intended to be a quick access place to
    # temporarily enable or disable services.
    #
    #       enabled         =
    #       disabled        =
    # Define general logging characteristics.
        log_type        = SYSLOG daemon info
        log_on_failure  = HOST
        log_on_success  = PID HOST DURATION EXIT
    # Define access restriction defaults
    #
    #       no_access       =
    #       only_from       =
    #       max_load        = 0
        cps             = 50 10
        instances       = 50
        per_source      = 10
    # Address and networking defaults
    #
    #       bind            =
    #       mdns            = yes
        v6only          = no

    # setup environmental attributes
    #
    #       passenv         =
        groups          = yes
        umask           = 002

    # Generally, banners are not used. This sets up their global defaults
    #   
    #       banner          =
    #       banner_fail     =
    #       banner_success  =
    }
    includedir /etc/xinetd.d
    ```
### 1.3 Restricting via TCP Wrappers
- 